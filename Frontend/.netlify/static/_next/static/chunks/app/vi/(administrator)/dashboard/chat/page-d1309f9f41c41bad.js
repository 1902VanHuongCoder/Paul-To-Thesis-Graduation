(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7005],{4596:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(52596),s=r(39688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},6368:(e,t,r)=>{"use strict";r.d(t,{Vf:()=>s,X3:()=>n,bX:()=>i,cK:()=>c,iS:()=>o});var a=r(20858);let s=async e=>{try{let t=await fetch("".concat(a.p,"/api/chat/").concat(e));if(!t.ok)throw Error("Failed to load messages");return await t.json()}catch(e){throw console.error("Error loading chat messages:",e),e}},n=async(e,t,r)=>{try{let s=await fetch("".concat(a.p,"/api/chat/add-new-message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationID:e,senderID:t,content:r})});if(!s.ok)throw Error("Failed to send message");return await s.json()}catch(e){throw console.error("Error sending message:",e),e}},o=async(e,t)=>{try{if(!(await fetch("".concat(a.p,"/api/chat/mark-messages-read"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationID:e,userID:t})})).ok)throw Error("Failed to mark messages as read")}catch(e){throw console.error("Error marking messages as read:",e),e}},i=async e=>{try{let t=await fetch("".concat(a.p,"/api/chat/conversations/").concat(e));if(!t.ok)throw Error("Failed to fetch conversations");return await t.json()}catch(e){throw console.error("Error fetching conversations:",e),e}},c=async e=>{let{conversationID:t,conversationName:r,conversationAvatar:s,participants:n,isGroup:o}=e;try{console.log("Creating conversation with ID:",{conversationID:t,conversationName:r,participants:n,isGroup:o});let e=await fetch("".concat(a.p,"/api/chat/create-conversation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationID:t,conversationName:r,conversationAvatar:s,participants:n,isGroup:o})});if(!e.ok)throw Error("Failed to create conversation");let i=await e.json();return console.log("Conversation created:",i),i.conversation}catch(e){throw console.error("Error creating conversation:",e),e}}},19946:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var a=r(12115);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),o=e=>{let t=n(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},c=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:d="",children:u,iconNode:h,...f}=e;return(0,a.createElement)("svg",{ref:t,...l,width:s,height:s,stroke:r,strokeWidth:o?24*Number(n)/Number(s):n,className:i("lucide",d),...!u&&!c(f)&&{"aria-hidden":"true"},...f},[...h.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:c,...l}=r;return(0,a.createElement)(d,{ref:n,iconNode:t,className:i("lucide-".concat(s(o(e))),"lucide-".concat(e),c),...l})});return r.displayName=o(e),r}},20858:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});let a="https://paul-to-thesis-graduation-1.onrender.com"},21203:(e,t,r)=>{"use strict";r.d(t,{CF:()=>s,O7:()=>d,Oh:()=>p,Tq:()=>o,cC:()=>w,de:()=>g,eg:()=>u,ej:()=>h,iD:()=>n,kz:()=>i,lw:()=>m,md:()=>f,p3:()=>c,ug:()=>l});var a=r(20858);let s=async()=>{let e=await fetch("".concat(a.p,"/api/users"));if(!e.ok)throw Error("Failed to fetch users");return await e.json()},n=async(e,t)=>{let r=await fetch("".concat(a.p,"/api/users/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),s=await r.json();return 401===r.status?{status:"error",message:s.message,data:null,token:null}:{data:s.user,role:s.user.role,status:"success",token:s.token,isActive:s.user.isActive,message:"Login successful"}},o=async e=>{let t=await fetch("".concat(a.p,"/api/users/google"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Registration failed");return await t.json()},i=async(e,t,r,s)=>{let n=await fetch("".concat(a.p,"/api/users/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,shippingAddress:{address:t,phone:r,isDefault:s}})});return await n.json()},c=async e=>{let t=await fetch("".concat(a.p,"/api/users/google"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Google login failed");return await t.json()},l=async e=>{let t=await fetch("".concat(a.p,"/api/users/").concat(e));if(!t.ok)throw Error("Failed to fetch user info");return await t.json()},d=async(e,t)=>!!(await fetch("".concat(a.p,"/api/users/confirm-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userID:t,password:e})})).ok,u=async(e,t,r,s,n)=>{let o=await fetch("".concat(a.p,"/api/users/").concat(n),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,avatar:r,password:s})});if(!o.ok)throw Error("Failed to update user profile");return await o.json()},h=async(e,t)=>{let r=await fetch("".concat(a.p,"/api/users/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})});if(!r.ok)throw Error("Failed to update user profile");return await r.json()},f=async(e,t)=>{let r=await fetch("".concat(a.p,"/api/users/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!t})});if(!r.ok)throw Error("Failed to update user status");return r.ok},m=async e=>{let t=await fetch("".concat(a.p,"/api/users/").concat(e),{method:"DELETE"});return{message:(await t.json()).message,status:t.status}},p=async()=>{let e=await fetch("".concat(a.p,"/api/users/role/adm"));if(!e.ok)throw Error("Failed to fetch admins");return await e.json()},g=async(e,t)=>{let r=await fetch("".concat(a.p,"/api/users/check-recovery-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,code:t})});if(!r.ok)throw Error("Invalid recovery code");return await r.json()},w=async()=>{let e=await fetch("".concat(a.p,"/api/order/statistic/top-users"));if(!e.ok)throw Error("Failed to fetch top users by orders");return await e.json()}},25606:(e,t,r)=>{Promise.resolve().then(r.bind(r,87587))},35695:(e,t,r)=>{"use strict";var a=r(18999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},38510:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(20858);let s=(0,r(14298).io)(a.p)},45574:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var a=r(95155);r(12115);var s=r(4596);function n(e){let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},87587:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(95155),s=r(89179),n=r(12115),o=r(71366),i=r(66766),c=r(6368),l=r(38510),d=r(35695),u=r(21203),h=r(45574);function f(){let[e,t]=(0,n.useState)(null),[r,f]=(0,n.useState)([]),{user:m}=(0,s.J)(),p=(0,d.useSearchParams)().get("conversationID"),[g,w]=(0,n.useState)(p),[x,v]=(0,n.useState)([]),[y,b]=(0,n.useState)(""),j=(0,n.useRef)(null),[N,D]=(0,n.useState)(""),[I,S]=(0,n.useState)(""),[k,E]=(0,n.useState)(!1),C=async()=>{if(!m)return;let e=[];try{e=await (0,u.Oh)()}catch(e){console.error("Error initializing chat:",e)}E(!0);let r=O(m.userID,N,!0),a=[N,...e.map(e=>e.userID)];try{let e=await (0,c.cK)({conversationID:r,conversationName:"Hỗ trợ user ".concat(N),participants:a,isGroup:!0});t(e),w(e.conversationID);let s=await (0,c.bX)(m.userID);f(s),l.A&&e.conversationID?l.A.connected?l.A.emit("join_room",e.conversationID):l.A.on("connect",()=>{l.A.emit("join_room",e.conversationID)}):console.error("Socket connection not established or conversationID missing.")}catch(e){console.error("Error creating conversation:",e)}E(!1)};(0,n.useEffect)(()=>{if(!l.A)return;let e=e=>{String(e.room)===String(g)&&v(t=>[...t,{messageID:Math.random(),conversationID:String(g),senderID:e.senderID,content:e.message,createdAt:new Date().toISOString(),sender:e.sender||{userID:e.senderID,username:e.username,email:""}}])};return l.A.on("send_message",e),()=>{l.A.off("send_message",e)}},[g]),(0,n.useEffect)(()=>{(async()=>{if(g)try{let e=await (0,c.Vf)(g);v(e)}catch(e){v([]),console.error("Error loading messages:",e)}})()},[g]);let A=async()=>{if(y.trim()&&g&&m){if(!await (0,c.X3)(g,m.userID,y))return void console.error("Failed to send message");l.A.emit("send_message",{room:g,username:m.username,message:y,senderID:m.userID,sender:{userID:m.userID,username:m.username,email:m.email}}),b(""),v(e=>[...e,{messageID:Math.random(),conversationID:String(g),senderID:m.userID,content:y,createdAt:new Date().toISOString(),sender:{userID:m.userID,username:m.username,email:m.email}}])}},O=(e,t,r)=>{let a=new Date().getDay(),s=new Date().getMonth()+1,n=new Date().getFullYear(),o=Math.floor(900*Math.random())+100;return r?"GRP".concat(e).concat(a).concat(s).concat(n).concat(o):"CON".concat(e).concat(t).concat(a).concat(s).concat(n).concat(o)};return(0,n.useEffect)(()=>(l.A&&g&&l.A.emit("join_room",g),()=>{l.A&&g&&l.A.emit("leave_room",g)}),[g]),(0,n.useEffect)(()=>{(async()=>{if(m)try{let e=await (0,c.bX)(m.userID);f(e),console.log("Fetched conversations:",e)}catch(e){console.error("Error fetching conversations:",e)}})()},[m]),(0,n.useEffect)(()=>{j.current&&j.current.scrollIntoView({behavior:"smooth"})},[x]),(0,a.jsx)("div",{className:"min-h-screen",children:(0,a.jsx)("div",{className:"flex flex-col items-center",children:(0,a.jsxs)("div",{className:"w-full  bg-white rounded-xl border",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center px-6 py-4 border-b",children:[(0,a.jsx)("input",{className:"flex-1 rounded-md px-3 py-2 text-sm border border-[#0d401c] focus:ring-2 focus:ring-[#278d45] transition",placeholder:"Nhập userID kh\xe1ch h\xe0ng...",value:N,onChange:e=>D(e.target.value),disabled:k}),(0,a.jsx)("button",{className:"px-4 py-2 rounded-md text-sm font-semibold shadow disabled:opacity-60 transition",style:{background:"#0d401c",color:"#fff"},onClick:C,disabled:!N||k,children:k?"Đang tải...":"Mở tr\xf2 chuyện"})]}),(0,a.jsxs)("div",{className:"flex w-full min-h-[600px]",children:[(0,a.jsxs)("aside",{className:"w-72 border-r flex flex-col bg-[#f6f8f7]",children:[(0,a.jsxs)("div",{className:"p-5 border-b flex items-center gap-3 font-bold text-lg bg-white text-[#0d401c]",children:[(0,a.jsx)(o.A,{className:"w-6 h-6"})," Tr\xf2 chuyện"]}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(h.p,{className:"border rounded-md px-3 py-2 text-sm w-full focus:ring-2 focus:ring-[#278d45] transition",style:{borderColor:"#0d401c",color:"#0d401c"},placeholder:"T\xecm kiếm userID kh\xe1ch h\xe0ng...",value:I,onChange:e=>S(e.target.value),disabled:k})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[calc(100vh-200px)]",children:r.length>0?(0,a.jsx)("ul",{className:"pl-0",children:(I?r.filter(e=>e.conversation.conversationID.includes(I)):r).map(e=>{var t;return(0,a.jsx)("li",{className:"px-2",children:(0,a.jsxs)("button",{className:"w-full flex items-center gap-3 px-4 py-3 rounded-md mb-2 transition text-left ".concat(g===e.conversationID?"border border-[#278d45] bg-[#eaf7ef]":"hover:bg-[#eaf7ef]"),onClick:async()=>{if(w(e.conversationID),m)try{await (0,c.iS)(e.conversationID,m.userID);let t=await (0,c.bX)(m.userID);f(t)}catch(e){console.error("Error marking messages as read:",e)}},children:[(0,a.jsx)("span",{className:"flex items-center justify-center w-10 h-10 rounded-full font-bold text-lg bg-[#0d401c] text-white",children:e.conversation.conversationAvatar?(0,a.jsx)("div",{className:"rounded-full h-10 w-10 overflow-hidden border-2 border-white shadow",children:(0,a.jsx)(i.default,{src:e.conversation.conversationAvatar,alt:"Avatar",width:40,height:40,className:"rounded-full h-full w-full object-cover"})}):(0,a.jsx)(o.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-semibold truncate text-[#0d401c]",children:e.conversation.conversationName}),(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:e.conversation.newestMessage||"Chưa c\xf3 tin nhắn."})]}),(null==(t=e.conversation.messages)?void 0:t.length)?(0,a.jsx)("span",{className:"ml-2 rounded-full px-2 py-0.5 text-xs font-bold bg-[#278d45] text-white",children:e.conversation.messages.length}):null]})},e.conversationID)})}):(0,a.jsx)("div",{className:"p-5 text-gray-400 text-center",children:"Kh\xf4ng c\xf3 cuộc tr\xf2 chuyện n\xe0o."})})]}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col h-full bg-white",children:[(0,a.jsx)("div",{className:"p-5 border-b font-semibold text-base bg-white text-[#0d401c] min-h-[56px] flex items-center",children:(null==e?void 0:e.conversationName)||"Chọn một cuộc tr\xf2 chuyện để bắt đầu"}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-white max-h-[calc(100vh-180px)]",children:[0===x.length&&(0,a.jsx)("div",{className:"text-gray-400 text-center mt-10",children:"Chưa c\xf3 tin nhắn n\xe0o."}),x.length>0&&x.map((e,t)=>{var r;return(0,a.jsxs)("div",{className:"mb-4 flex ".concat(e.senderID===(null==m?void 0:m.userID)?"justify-end":"justify-start"),children:[(0,a.jsxs)("div",{className:"rounded-xl px-4 py-2 max-w-[70%] break-words shadow",style:{background:e.senderID===(null==m?void 0:m.userID)?"#0d401c":"#f6f8f7",color:e.senderID===(null==m?void 0:m.userID)?"#fff":"#0d401c"},children:[(0,a.jsx)("span",{className:"block mb-1",children:e.content}),(0,a.jsxs)("span",{className:"block text-xs text-right opacity-70",children:[(null==(r=e.sender)?void 0:r.username)||e.senderID," | ",new Date(e.createdAt).toLocaleTimeString()]})]}),t===x.length-1&&(0,a.jsx)("div",{ref:j})]},e.messageID||Math.random())})]}),g&&(0,a.jsxs)("div",{className:"p-4 border-t flex gap-3 bg-white",children:[(0,a.jsx)("input",{className:"flex-1 border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#278d45] transition text-base bg-white shadow",style:{borderColor:"#0d401c",color:"#0d401c"},placeholder:"Nhập tin nhắn...",value:y,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&A()}),(0,a.jsx)("button",{className:"px-6 py-2 rounded-full font-semibold shadow transition text-base bg-[#278d45] text-white",onClick:A,children:"Gửi"})]})]})]})]})})})}function m(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Đang tải chat..."}),children:(0,a.jsx)(f,{})})}},89179:(e,t,r)=>{"use strict";r.d(t,{J:()=>l,UserProvider:()=>c});var a=r(95155),s=r(35695),n=r(12115),o=r(13568);let i=(0,n.createContext)(void 0);function c(e){let{children:t}=e,r=(0,s.usePathname)(),c=(0,s.useRouter)(),[l,d]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("admin");r.includes("dashboard")&&t?d(JSON.parse(t)):e&&d(JSON.parse(e))},[r]),(0,a.jsx)(i.Provider,{value:{user:l,setUser:d,logout:()=>{d(null),localStorage.removeItem("user"),r.includes("dashboard")&&localStorage.removeItem("admin"),c.push("/"),o.Ay.success("Đăng xuất th\xe0nh c\xf4ng!")}},children:t})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useUser must be used within a UserProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,3568,6766,8037,8441,1684,7358],()=>t(25606)),_N_E=e.O()}]);