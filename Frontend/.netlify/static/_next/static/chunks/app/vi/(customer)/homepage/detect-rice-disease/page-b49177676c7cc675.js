(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{6278:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var l=s(95155),r=s(12115),a=s(75109),n=s(24932),i=s(17e3),d=s(36761),c=s(81891),o=s(63356),h=s(26333),x=s(84109),m=s(90192),p=s(423),f=s(79030),u=s(43557),g=s(74324),b=s(84879),j=s(40872),v=s(66766),y=s(25957);let w=(0,s(19946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var N=s(92657),k=s(6874),C=s.n(k),D=s(28474),S=s(20858);let A=async e=>{let t=new FormData;t.append("file",e);let s=await fetch("http://127.0.0.1:8000/predict",{method:"POST",body:t});if(!s.ok)throw Error("Failed to detect rice disease");return s.json()},P=async e=>{let t=await fetch("".concat(S.p,"/api/disease/private/by-en-name/").concat(e));return t.ok?await t.json():null};var I=s(10173);function O(){let[e,t]=(0,r.useState)(!1),[s,k]=(0,r.useState)(null),S=(0,a.hG)({extensions:[n.A,i.A,d.Ay,c.Ay,o.A,h.Ay.configure({nested:!0}),x.A.configure({types:["heading","paragraph"]}),m.Ay.configure({resizable:!0}),p.A,f.h,u.A],content:(null==s?void 0:s.symptoms)?s.symptoms:"<p>Đang tải...</p>",editable:!1,immediatelyRender:!1});r.useEffect(()=>{S&&(null==s?void 0:s.symptoms)&&S.commands.setContent(s.symptoms)},[s,S]);let[O,_]=(0,r.useState)(null),[E,L]=(0,r.useState)(null),[K,W]=(0,r.useState)(!1),[G,R]=(0,r.useState)(null),[T,q]=(0,r.useState)(!1),{result:M,setResult:H}=(0,D.L)(),[z,B]=(0,r.useState)(M||[]),[F,U]=(0,r.useState)(!1),[V,X]=(0,r.useState)([]),[J,Q]=(0,r.useState)(!1),[,Z]=(0,r.useState)(void 0),$=async e=>{if(e.preventDefault(),O){W(!0),R(null),L(null),B([]),new FormData().append("file",O);try{let e=await A(O);if(e&&e.predicted_class&&e.all_probs&&e.all_probs.length>0){L({class:e.predicted_class,confidence:e.all_probs[0][1]});let t=e.all_probs.map(e=>{let[t]=e;return t}),s=await Promise.all(t.map(async e=>{let t=await P(e);return t?{diseaseID:t.diseaseID,diseaseName:t.diseaseName,diseaseEnName:t.diseaseEnName,ricePathogen:t.ricePathogen,symptoms:t.symptoms,images:t.images||[]}:null}));B(s.filter(e=>null!==e)),H(s.filter(e=>null!==e))}else R("Kh\xf4ng thể nhận diện bệnh l\xfaa. Vui l\xf2ng thử lại với ảnh kh\xe1c.")}catch(e){R("Lỗi khi nhận diện bệnh l\xfaa. Vui l\xf2ng thử lại sau."),console.log(e)}finally{W(!1)}}},Y=async e=>{if(e){Q(!0),Z(e);try{let t=(await (0,I.j0)()).filter(t=>{let s=[];if("string"==typeof t.diseases)try{s=JSON.parse(t.diseases)}catch(e){s=[]}else Array.isArray(t.diseases)&&(s=t.diseases);return s.map(String).includes(String(e))});X(t),U(!0)}catch(e){console.error("Error fetching products:",e),X([]),U(!0)}finally{Q(!1)}}};return(0,l.jsxs)("div",{className:"px-6 py-10 font-sans bg-gradient-to-br from-[#eaf7ef] via-white to-[#f8fbe9] min-h-screen",children:[(0,l.jsx)(y.Qp,{items:[{label:"Trang chủ",href:"/"},{label:"Chẩn đo\xe1n bệnh l\xfaa"}]}),(0,l.jsx)("h1",{className:"text-3xl font-extrabold mb-6 mt-8 uppercase text-center tracking-wide text-[#0d401c] drop-shadow-lg",children:"CHẨN ĐO\xc1N BỆNH DỰA TR\xcaN L\xc1 L\xdaA"}),(0,l.jsxs)("p",{className:"flex gap-2 py-4 bg-[#f8c32c]/20 rounded-lg shadow-sm mb-8 items-center px-4 border-l-4 border-[#f8c32c]",children:[(0,l.jsx)("span",{children:(0,l.jsx)(w,{className:"text-[#278d45]"})}),(0,l.jsx)("span",{className:"text-[#0d401c] font-medium",children:"Sử dụng h\xecnh ảnh l\xe1 l\xfaa chất lượng, kh\xf4ng bị mờ sẽ gi\xfap hệ thống chẩn đo\xe1n ch\xednh x\xe1c hơn."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_1px_1fr] gap-12 mx-auto",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("form",{onSubmit:$,className:"flex flex-col items-center gap-6 mb-8",onDragOver:e=>{e.preventDefault(),q(!0)},onDragLeave:e=>{e.preventDefault(),q(!1)},onDrop:e=>{e.preventDefault(),q(!1);let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&(_(t[0]),L(null),R(null),B([]))},children:[(0,l.jsxs)("div",{className:"w-full border-2 border-dashed rounded-3xl p-10 flex flex-col items-center justify-center transition-all cursor-pointer min-h-[340px] bg-gradient-to-br ".concat(T?"from-[#f8c32c]/30 to-[#278d45]/20 border-[#f8c32c] shadow-2xl":"from-white to-[#eaf7ef] border-[#278d45]/30 shadow-lg"," hover:shadow-2xl hover:border-[#278d45]"),onClick:()=>{var e;return null==(e=document.getElementById("detect-image-input"))?void 0:e.click()},role:"button",tabIndex:0,"aria-label":"K\xe9o thả hoặc click để tải ảnh",children:[(0,l.jsx)("input",{id:"detect-image-input",type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{e.target.files&&e.target.files[0]&&(_(e.target.files[0]),L(null),R(null),B([]))}}),O?(0,l.jsxs)("div",{className:"relative w-full min-h-[300px] max-h-[500px] rounded-xl overflow-hidden shadow-xl border-2 border-[#278d45]/30 bg-white mb-2 flex items-center justify-center",children:[(0,l.jsx)(v.default,{width:320,height:240,src:URL.createObjectURL(O),alt:"Uploaded",className:"w-full h-full object-contain rounded-xl"}),(0,l.jsx)(b.N,{children:K&&(0,l.jsxs)(j.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:10},children:[(0,l.jsxs)(j.P.div,{initial:{rotate:0},animate:{rotate:360},transition:{repeat:1/0,duration:1.2,ease:"linear"},style:{position:"relative",width:140,height:140},children:[(0,l.jsxs)("svg",{width:"140",height:"140",className:"block",children:[(0,l.jsxs)("defs",{children:[(0,l.jsxs)("radialGradient",{id:"scanGlow",cx:"50%",cy:"50%",r:"50%",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#f8c32c",stopOpacity:"0.8"}),(0,l.jsx)("stop",{offset:"70%",stopColor:"#278d45",stopOpacity:"0.2"}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#278d45",stopOpacity:"0"})]}),(0,l.jsxs)("linearGradient",{id:"scanArc",x1:"0",y1:"0",x2:"1",y2:"1",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#f8c32c"}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#278d45"})]})]}),(0,l.jsx)("circle",{cx:"70",cy:"70",r:"60",fill:"none",stroke:"url(#scanGlow)",strokeWidth:"10",style:{filter:"blur(2.5px)"}}),(0,l.jsx)(j.P.circle,{cx:"70",cy:"70",r:"52",fill:"none",stroke:"url(#scanArc)",strokeWidth:"8",strokeDasharray:"80 240",strokeDashoffset:"0",initial:{strokeDashoffset:0},animate:{strokeDashoffset:320},transition:{repeat:1/0,duration:1.2,ease:"linear"},style:{filter:"drop-shadow(0 0 8px #f8c32c88)"}}),(0,l.jsx)(j.P.circle,{cx:"70",cy:"70",r:"22",fill:"#f8c32c",stroke:"#278d45",strokeWidth:"3",animate:{scale:[1,1.12,1]},transition:{repeat:1/0,duration:1.2,ease:"easeInOut"},style:{opacity:.85,filter:"blur(0.5px)"}})]}),(0,l.jsx)(j.P.div,{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},animate:{opacity:[.7,1,.7]},transition:{repeat:1/0,duration:1.2,ease:"easeInOut"},children:(0,l.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,l.jsx)("span",{style:{width:"0.5rem",height:"0.5rem",borderRadius:"9999px",background:"#f8c32c",boxShadow:"0 2px 8px #f8c32c88"}}),(0,l.jsx)("span",{style:{width:"0.375rem",height:"0.375rem",borderRadius:"9999px",background:"#278d45",boxShadow:"0 1px 4px #278d4588"}}),(0,l.jsx)("span",{style:{width:"0.25rem",height:"0.25rem",borderRadius:"9999px",background:"#f8c32c",boxShadow:"0 1px 4px #f8c32c88"}})]})})]}),(0,l.jsx)("span",{className:"absolute left-1/2 top-full mt-4 -translate-x-1/2 text-[#278d45] font-bold bg-white/80 px-4 py-2 rounded-xl shadow border border-[#278d45]/20 text-base",children:"Đang qu\xe9t ảnh..."})]},"scan")})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("span",{className:"text-[#278d45] text-base mb-2 font-semibold tracking-wide",children:"K\xe9o thả hoặc click để tải ảnh bệnh l\xfaa"}),(0,l.jsx)("span",{className:"text-xs text-[#0d401c]/70",children:"(Chọn một ảnh)"}),(0,l.jsxs)("svg",{width:"64",height:"64",fill:"none",className:"mt-6 mb-2",children:[(0,l.jsx)("rect",{x:"2",y:"2",width:"60",height:"60",rx:"16",fill:"#f8c32c",stroke:"#278d45",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M32 18v28M18 32h28",stroke:"#0d401c",strokeWidth:"3",strokeLinecap:"round"})]})]})]}),(0,l.jsx)("div",{className:"flex justify-end w-full",children:(0,l.jsx)("button",{type:"submit",disabled:!O||K,className:"px-10 py-3 rounded-xl bg-gradient-to-r from-[#278d45] to-[#f8c32c] text-white font-bold shadow-xl hover:from-[#0d401c] hover:to-[#f8c32c]/90 transition-all disabled:opacity-60 disabled:cursor-not-allowed tracking-wide text-lg",children:K?(0,l.jsxs)("span",{className:"flex items-center gap-2",children:[(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Đang chẩn đo\xe1n..."]}):"Chẩn đo\xe1n"})})]})}),(0,l.jsx)("div",{className:"hidden md:block bg-gradient-to-b from-[#f8c32c]/40 to-[#278d45]/20 w-[2px] mx-auto rounded-full"}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-2 mb-4",children:[(0,l.jsxs)("svg",{width:"32",height:"32",fill:"none",children:[(0,l.jsx)("rect",{x:"2",y:"2",width:"28",height:"28",rx:"8",fill:"#f8c32c",stroke:"#278d45",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M16 9v12M9 16h14",stroke:"#0d401c",strokeWidth:"2",strokeLinecap:"round"})]}),(0,l.jsx)("span",{className:"ml-2 text-[#0d401c] font-semibold",children:"Kết quả chẩn đo\xe1n"})]}),0===z.length&&!E&&!G&&(0,l.jsx)("div",{className:"text-[#278d45]/60 text-center italic bg-white/90 rounded-xl py-10 shadow-inner border border-[#278d45]/10",children:"Chưa c\xf3 kết quả chẩn đo\xe1n."}),z.length>1&&E&&!G&&(0,l.jsxs)("div",{className:"text-[#278d45] flex gap-x-2 bg-[#f8c32c]/10 p-3 rounded-lg border border-[#f8c32c]/40 mb-4 shadow",children:[(0,l.jsx)("span",{children:(0,l.jsx)(w,{className:"text-[#f8c32c]"})}),(0,l.jsx)("span",{children:"Vui l\xf2ng kiểm tra xem c\xf3 bệnh n\xe0o dưới đ\xe2y tr\xf9ng với thiệt hại tr\xean c\xe2y l\xfaa của bạn kh\xf4ng"})]}),(0,l.jsxs)("div",{className:"mt-8",children:[z.length>0&&(0,l.jsx)("div",{className:"grid gap-8",children:z.map((e,s)=>(0,l.jsxs)("div",{className:"border border-[#278d45]/20 bg-white rounded-2xl p-6 hover:shadow-xl transition-all flex flex-col md:flex-row items-center gap-6",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-[120px] h-[120px] bg-white rounded-xl flex items-center justify-center border border-[#278d45]/10 shadow",children:e&&e.images&&e.images.length>0?(0,l.jsx)(v.default,{src:e.images[0],alt:"Disease",width:110,height:110,className:"rounded-lg object-cover border shadow w-full h-full"},e.diseaseID||s):(0,l.jsx)("span",{className:"text-[#278d45]/40 text-xs",children:"Kh\xf4ng c\xf3 h\xecnh ảnh"})}),(0,l.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,l.jsx)("div",{className:"font-bold text-2xl text-[#0d401c] uppercase tracking-wide",children:e.diseaseName}),(0,l.jsxs)("div",{className:"text-sm text-[#278d45]",children:[(0,l.jsx)("b",{children:"T\xean tiếng Anh:"})," ",e.diseaseEnName]}),(0,l.jsxs)("div",{className:"text-sm text-[#278d45]",children:[(0,l.jsx)("b",{children:"T\xe1c nh\xe2n:"})," ",e.ricePathogen]})]}),(0,l.jsx)("div",{children:(0,l.jsxs)("button",{className:"mt-2 px-5 py-2 border-[#278d45]/30 border-[1px] text-[#278d45] rounded-lg hover:bg-[#278d45] hover:text-white hover:cursor-pointer transition flex items-center gap-x-2 font-semibold shadow",onClick:()=>{k(e),t(!0)},children:[(0,l.jsx)("span",{children:"Xem chi tiết bệnh"}),(0,l.jsx)("span",{children:(0,l.jsx)(N.A,{})})]})})]},e.diseaseID||s))}),(0,l.jsx)(g.lG,{open:e,onOpenChange:t,children:(0,l.jsxs)(g.Cf,{className:"max-w-4xl bg-gray-100 rounded-2xl shadow-2xl border border-[#278d45]/20",children:[(0,l.jsx)(g.c7,{children:(0,l.jsx)(g.L3,{className:"uppercase text-center text-2xl text-[#0d401c] font-extrabold tracking-wide",children:(null==s?void 0:s.diseaseName)||"Chi tiết bệnh"})}),(0,l.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,l.jsx)("div",{className:"mb-4 max-w-full flex justify-center gap-x-2",children:(null==s?void 0:s.images)&&s.images.length>0?(0,l.jsx)("div",{className:"w-[320px] h-[320px] rounded-xl overflow-hidden border-2 border-[#278d45]/20 shadow-xl bg-white",children:(0,l.jsx)(v.default,{src:s.images[0],alt:"Disease",width:320,height:320,className:"rounded-lg object-cover w-full h-full"})}):(0,l.jsx)("div",{className:"w-[320px] h-[320px] flex items-center justify-center text-[#278d45]/40 bg-[#eaf7ef] rounded-xl border",children:"Kh\xf4ng c\xf3 h\xecnh ảnh"})}),(0,l.jsxs)("div",{className:"text-[#278d45]",children:[(0,l.jsx)("b",{children:"T\xean tiếng Anh:"})," ",(0,l.jsx)("span",{className:"text-xl font-semibold",children:null==s?void 0:s.diseaseEnName})]}),(0,l.jsxs)("div",{className:"text-[#278d45]",children:[(0,l.jsx)("b",{children:"T\xe1c nh\xe2n:"})," ",(0,l.jsx)("span",{className:"text-xl font-semibold",children:null==s?void 0:s.ricePathogen})]})]}),(0,l.jsx)("div",{className:"prose prose-blue max-w-none tiptap-content mb-8 bg-white/90 rounded-lg p-4 border border-[#278d45]/10",children:(null==s?void 0:s.symptoms)&&(0,l.jsx)(a.$Z,{editor:S,className:"tiptap-editor"})}),(0,l.jsx)(g.HM,{asChild:!0,children:(0,l.jsxs)("div",{className:"flex gap-x-4",children:[(0,l.jsx)("button",{className:"mt-2 px-4 py-2 rounded-lg font-semibold border border-[#278d45] hover:bg-[#eaf7ef] transition w-full hover:cursor-pointer text-[#278d45]",children:"Đ\xf3ng"}),(0,l.jsx)("button",{className:"mt-2 px-4 py-2 rounded-lg bg-gradient-to-r from-[#278d45] to-[#f8c32c] text-white font-bold shadow hover:from-[#0d401c] hover:to-[#f8c32c]/90 transition w-full hover:cursor-pointer",onClick:()=>{s&&s.diseaseID&&Y(s.diseaseID),t(!1)},children:"Xem thuốc"})]})})]})}),(0,l.jsx)(g.lG,{open:F,onOpenChange:U,children:(0,l.jsxs)(g.Cf,{className:"max-w-3xl bg-white rounded-2xl shadow-2xl border border-[#278d45]/20",children:[(0,l.jsxs)(g.c7,{children:[(0,l.jsx)(g.L3,{className:"text-xl text-[#0d401c] font-bold",children:"Danh s\xe1ch sản phẩm li\xean quan đến bệnh"}),(0,l.jsxs)("p",{className:"flex items-center gap-x-2 p-2 bg-[#f8c32c]/10 rounded-md border border-[#f8c32c]/30 text-[#278d45]",children:[(0,l.jsx)("span",{children:(0,l.jsx)(w,{className:"text-[#f8c32c]"})}),(0,l.jsx)("span",{children:"Chỉ chọn một sản phẩm để giải quyết vấn đề hiện tại. Khuyến kh\xedch sản phẩm \xedt độc hại cho l\xfaa."})]})]}),J?(0,l.jsx)("div",{className:"text-center py-8 text-[#278d45] font-semibold",children:"Đang tải sản phẩm..."}):0===V.length?(0,l.jsx)("div",{className:"text-center py-8 text-[#0d401c]/60",children:"Kh\xf4ng c\xf3 sản phẩm n\xe0o li\xean quan đến bệnh n\xe0y."}):(0,l.jsx)("div",{className:"grid gap-4",children:V.map((e,t)=>{var s;return(0,l.jsxs)(C(),{href:"/vi/homepage/product-details/".concat(e.productID),className:"border border-[#278d45]/20 bg-white/95 rounded-xl p-4 flex gap-x-4 items-center shadow hover:shadow-xl transition-all",children:[(0,l.jsx)("div",{className:"w-[90px] h-[90px] flex-shrink-0 rounded-lg overflow-hidden border border-[#278d45]/10 bg-[#eaf7ef] flex items-center justify-center",children:e.images&&e.images.length>0?(0,l.jsx)(v.default,{src:e.images[0],alt:e.productName,width:90,height:90,className:"rounded-lg object-cover w-full h-full"}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[#278d45]/40",children:"Kh\xf4ng c\xf3 h\xecnh ảnh"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"font-bold text-lg text-[#0d401c]",children:e.productName}),(0,l.jsxs)("div",{className:"text-sm text-[#278d45]",children:["Gi\xe1: ",null==(s=e.productPrice)?void 0:s.toLocaleString(),"đ"]}),(0,l.jsxs)("div",{className:"text-sm text-[#278d45]",children:["Đơn vị: ",e.unit]})]})]},e.productID||t)})}),(0,l.jsx)(g.HM,{asChild:!0,children:(0,l.jsx)("button",{className:"mt-6 px-4 py-2 rounded-lg font-semibold border border-[#278d45] hover:bg-[#eaf7ef] transition w-full hover:cursor-pointer text-[#278d45]",children:"Đ\xf3ng"})})]})})]})]})]}),G&&(0,l.jsx)("div",{className:"text-[#52320a] mt-8 text-center font-semibold bg-[#f8c32c]/20 border border-[#f8c32c]/40 rounded-xl py-5 max-w-xl mx-auto shadow-lg",children:G})]})}},28474:(e,t,s)=>{"use strict";s.d(t,{DiagnoseProvider:()=>n,L:()=>i});var l=s(95155),r=s(12115);let a=(0,r.createContext)(void 0),n=e=>{let{children:t}=e,[s,n]=(0,r.useState)(null);return(0,l.jsx)(a.Provider,{value:{result:s,setResult:n},children:t})},i=()=>{let e=(0,r.useContext)(a);if(!e)throw Error("useDiagnoseContext must be used within a DiagnoseProvider");return e}},90367:(e,t,s)=>{Promise.resolve().then(s.bind(s,6278))}},e=>{var t=t=>e(e.s=t);e.O(0,[7935,6122,5004,277,4277,3568,6231,1350,6766,56,1193,7625,2727,6874,4754,8037,4297,5692,1787,8612,5957,8441,1684,7358],()=>t(90367)),_N_E=e.O()}]);