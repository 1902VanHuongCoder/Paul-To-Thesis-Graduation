(()=>{var e={};e.id=7005,e.ids=[7005],e.modules={2842:(e,r,t)=>{Promise.resolve().then(t.bind(t,42481))},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15891:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Learning Web\\\\Thesis\\\\Frontend\\\\src\\\\app\\\\vi\\\\(administrator)\\\\dashboard\\\\chat\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Learning Web\\Thesis\\Frontend\\src\\app\\vi\\(administrator)\\dashboard\\chat\\page.tsx","default")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},42481:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var s=t(60687),n=t(36027),a=t(43210),i=t(33872),o=t(30474),l=t(14302),d=t(57762),c=t(16189),u=t(23045),h=t(97902);function x(){let[e,r]=(0,a.useState)(null),[t,x]=(0,a.useState)([]),{user:m}=(0,n.J)(),p=(0,c.useSearchParams)().get("conversationID"),[f,v]=(0,a.useState)(p),[b,g]=(0,a.useState)([]),[w,j]=(0,a.useState)(""),D=(0,a.useRef)(null),[y,N]=(0,a.useState)(""),[I,q]=(0,a.useState)(""),[k,P]=(0,a.useState)(!1),_=async()=>{if(!m)return;let e=[];try{e=await (0,u.Oh)()}catch(e){console.error("Error initializing chat:",e)}P(!0);let t=C(m.userID,y,!0),s=[y,...e.map(e=>e.userID)];try{let e=await (0,l.cK)({conversationID:t,conversationName:`Hỗ trợ user ${y}`,participants:s,isGroup:!0});r(e),v(e.conversationID);let n=await (0,l.bX)(m.userID);x(n),d.A&&e.conversationID?d.A.connected?d.A.emit("join_room",e.conversationID):d.A.on("connect",()=>{d.A.emit("join_room",e.conversationID)}):console.error("Socket connection not established or conversationID missing.")}catch(e){console.error("Error creating conversation:",e)}P(!1)},A=async()=>{if(w.trim()&&f&&m){if(!await (0,l.X3)(f,m.userID,w))return void console.error("Failed to send message");d.A.emit("send_message",{room:f,username:m.username,message:w,senderID:m.userID,sender:{userID:m.userID,username:m.username,email:m.email}}),j(""),g(e=>[...e,{messageID:Math.random(),conversationID:String(f),senderID:m.userID,content:w,createdAt:new Date().toISOString(),sender:{userID:m.userID,username:m.username,email:m.email}}])}},C=(e,r,t)=>{let s=new Date().getDay(),n=new Date().getMonth()+1,a=new Date().getFullYear(),i=Math.floor(900*Math.random())+100;return t?`GRP${e}${s}${n}${a}${i}`:`CON${e}${r}${s}${n}${a}${i}`};return(0,s.jsx)("div",{className:"min-h-screen",children:(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsxs)("div",{className:"w-full  bg-white rounded-xl border",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center px-6 py-4 border-b",children:[(0,s.jsx)("input",{className:"flex-1 rounded-md px-3 py-2 text-sm border border-[#0d401c] focus:ring-2 focus:ring-[#278d45] transition",placeholder:"Nhập userID kh\xe1ch h\xe0ng...",value:y,onChange:e=>N(e.target.value),disabled:k}),(0,s.jsx)("button",{className:"px-4 py-2 rounded-md text-sm font-semibold shadow disabled:opacity-60 transition",style:{background:"#0d401c",color:"#fff"},onClick:_,disabled:!y||k,children:k?"Đang tải...":"Mở tr\xf2 chuyện"})]}),(0,s.jsxs)("div",{className:"flex w-full min-h-[600px]",children:[(0,s.jsxs)("aside",{className:"w-72 border-r flex flex-col bg-[#f6f8f7]",children:[(0,s.jsxs)("div",{className:"p-5 border-b flex items-center gap-3 font-bold text-lg bg-white text-[#0d401c]",children:[(0,s.jsx)(i.A,{className:"w-6 h-6"})," Tr\xf2 chuyện"]}),(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(h.p,{className:"border rounded-md px-3 py-2 text-sm w-full focus:ring-2 focus:ring-[#278d45] transition",style:{borderColor:"#0d401c",color:"#0d401c"},placeholder:"T\xecm kiếm userID kh\xe1ch h\xe0ng...",value:I,onChange:e=>q(e.target.value),disabled:k})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[calc(100vh-200px)]",children:t.length>0?(0,s.jsx)("ul",{className:"pl-0",children:(I?t.filter(e=>e.conversation.conversationID.includes(I)):t).map(e=>(0,s.jsx)("li",{className:"px-2",children:(0,s.jsxs)("button",{className:`w-full flex items-center gap-3 px-4 py-3 rounded-md mb-2 transition text-left ${f===e.conversationID?"border border-[#278d45] bg-[#eaf7ef]":"hover:bg-[#eaf7ef]"}`,onClick:async()=>{if(v(e.conversationID),m)try{await (0,l.iS)(e.conversationID,m.userID);let r=await (0,l.bX)(m.userID);x(r)}catch(e){console.error("Error marking messages as read:",e)}},children:[(0,s.jsx)("span",{className:"flex items-center justify-center w-10 h-10 rounded-full font-bold text-lg bg-[#0d401c] text-white",children:e.conversation.conversationAvatar?(0,s.jsx)("div",{className:"rounded-full h-10 w-10 overflow-hidden border-2 border-white shadow",children:(0,s.jsx)(o.default,{src:e.conversation.conversationAvatar,alt:"Avatar",width:40,height:40,className:"rounded-full h-full w-full object-cover"})}):(0,s.jsx)(i.A,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-semibold truncate text-[#0d401c]",children:e.conversation.conversationName}),(0,s.jsx)("div",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:e.conversation.newestMessage||"Chưa c\xf3 tin nhắn."})]}),e.conversation.messages?.length?(0,s.jsx)("span",{className:"ml-2 rounded-full px-2 py-0.5 text-xs font-bold bg-[#278d45] text-white",children:e.conversation.messages.length}):null]})},e.conversationID))}):(0,s.jsx)("div",{className:"p-5 text-gray-400 text-center",children:"Kh\xf4ng c\xf3 cuộc tr\xf2 chuyện n\xe0o."})})]}),(0,s.jsxs)("main",{className:"flex-1 flex flex-col h-full bg-white",children:[(0,s.jsx)("div",{className:"p-5 border-b font-semibold text-base bg-white text-[#0d401c] min-h-[56px] flex items-center",children:e?.conversationName||"Chọn một cuộc tr\xf2 chuyện để bắt đầu"}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-white max-h-[calc(100vh-180px)]",children:[0===b.length&&(0,s.jsx)("div",{className:"text-gray-400 text-center mt-10",children:"Chưa c\xf3 tin nhắn n\xe0o."}),b.length>0&&b.map((e,r)=>(0,s.jsxs)("div",{className:`mb-4 flex ${e.senderID===m?.userID?"justify-end":"justify-start"}`,children:[(0,s.jsxs)("div",{className:"rounded-xl px-4 py-2 max-w-[70%] break-words shadow",style:{background:e.senderID===m?.userID?"#0d401c":"#f6f8f7",color:e.senderID===m?.userID?"#fff":"#0d401c"},children:[(0,s.jsx)("span",{className:"block mb-1",children:e.content}),(0,s.jsxs)("span",{className:"block text-xs text-right opacity-70",children:[e.sender?.username||e.senderID," | ",new Date(e.createdAt).toLocaleTimeString()]})]}),r===b.length-1&&(0,s.jsx)("div",{ref:D})]},e.messageID||Math.random()))]}),f&&(0,s.jsxs)("div",{className:"p-4 border-t flex gap-3 bg-white",children:[(0,s.jsx)("input",{className:"flex-1 border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#278d45] transition text-base bg-white shadow",style:{borderColor:"#0d401c",color:"#0d401c"},placeholder:"Nhập tin nhắn...",value:w,onChange:e=>j(e.target.value),onKeyDown:e=>"Enter"===e.key&&A()}),(0,s.jsx)("button",{className:"px-6 py-2 rounded-full font-semibold shadow transition text-base bg-[#278d45] text-white",onClick:A,children:"Gửi"})]})]})]})]})})})}function m(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{children:"Đang tải chat..."}),children:(0,s.jsx)(x,{})})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},55986:(e,r,t)=>{Promise.resolve().then(t.bind(t,15891))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},95841:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d});var s=t(65239),n=t(48088),a=t(88170),i=t.n(a),o=t(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let d={children:["",{children:["vi",{children:["(administrator)",{children:["dashboard",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,15891)),"D:\\Learning Web\\Thesis\\Frontend\\src\\app\\vi\\(administrator)\\dashboard\\chat\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,41529)),"D:\\Learning Web\\Thesis\\Frontend\\src\\app\\vi\\(administrator)\\dashboard\\layout.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,15097)),"D:\\Learning Web\\Thesis\\Frontend\\src\\app\\vi\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["D:\\Learning Web\\Thesis\\Frontend\\src\\app\\vi\\(administrator)\\dashboard\\chat\\page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/vi/(administrator)/dashboard/chat/page",pathname:"/vi/dashboard/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,4825,7076,4866,8601,177],()=>t(95841));module.exports=s})();